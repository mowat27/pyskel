#!/usr/bin/env bash

# Setup strict bash mode
# http://redsymbol.net/articles/unofficial-bash-strict-mode/
set -euo pipefail

if [[ $# -lt 1 ]]; then
  echo -n "Project name: "
  read -r project_name
else 
  project_name=$1
fi

mkdir "${project_name}" 
cd "${project_name}" || exit 1

echo >&2 "-- Creating $project_name files -------------------------------------"
mkdir "${project_name}"
curl http://gitignore.io/api/python,visualstudiocode > .gitignore 
touch "${project_name}/__init__.py"

cat > setup.py <<EOF
from setuptools import setup, find_packages

setup(
  name="${project_name}",
  version="0.1.0",
  packages=find_packages()
)
EOF
chmod +x setup.py

echo >&2 "-- Creating $project_name test starter ------------------------------"
mkdir tests
echo 'import pytest' > "tests/conftest.py"
echo 'import pytest' > "tests/test_${project_name}.py"

echo >&2 "-- Installing ${project_name} and dependencies ----------------------"
pipenv install -e .
pipenv install --dev pytest pylint autopep8 rope

echo >&2 "-- Initializing git -------------------------------------------------"
git init 
git add -A  
git commit -m "Initial - generated by $(basename "$0")"


